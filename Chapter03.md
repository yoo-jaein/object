# Chapter 03 역할, 책임, 협력

## 역할, 책임, 협력
객체들이 애플리케이션의 기능을 구현하기 위해 수행하는 상호작용을 **협력**이라고 한다. 객체가 협력에 참여하기 위해 수행하는 로직은 **책임**이라고 부른다. 객체들이 협력 안에서 수행하는 책임들이 모여 객체가 수행하는 **역할**을 구성한다.  

## 메시지 전송
메시지를 전송하는 것은 객체 사이의 협력을 위해 사용할 수 있는 유일한 커뮤니케이션 수단이다. 메시지를 수신한 객체는 메서드를 실행해 요청에 응답한다. 여기서 객체는 자신의 일을 스스로 처리하는 자율적인 존재다.

## 책임
**책임은 객체지향 설계의 핵심이다.** 객체에게 책임을 할당하기 위해서는 먼저 협력이라는 문맥을 정의해야 한다. 

### 책임 할당하기
기능을 시스템이 담당할 하나의 책임으로 생각하자. 그리고 시스템의 책임을 완료하는 데 필요한 더 작은 책임을 찾아내고 이를 객체들에게 할당하는 과정을 반복한다. 책임을 할당할 때는 객체가 메시지를 선택하는 것이 아니라 메시지가 객체를 선택하게 해야 한다. 객체는 최소한의 추상적인 인터페이스만 가지도록 구성한다.  

### 책임 주도 설계
**책임 주도 설계**(Responsibility-Driven Design, RDD)란 책임을 찾고 책임을 수행할 적절한 객체를 찾아 책임을 할당하는 방식으로 협력을 설계하는 방법이다. 구현이 아닌 책임에 집중하는 것이 중요한 이유는 유연하고 견고한 객체지향 시스템을 위해 가장 중요한 재료가 바로 책임이기 때문이다. 

### 데이터 주도 설계
**데이터 주도 설계**(Data-Driven Design)란 먼저 객체에 필요한 상태를 결정하고 그 후에 상태에 필요한 행동을 결정하는 방법이다. 결론적으로 데이터 주도 설계는 지양되어야 한다. 이 방식은 객체의 내부 구현이 퍼블릭 인터페이스에 노출되도록 만들기 때문에 캡슐화를 저해하기 때문이다.

데이터, 즉 상태는 내부 구현에 해당하며 내부 구현을 변경하면 퍼블릭 인터페이스도 함께 변경되고 결국 객체에 의존하는 클라이언트 객체로 영향이 전파된다. 따라서 데이터 주도 설계를 하면 구현이 항상 불안정하고 변경될 가능성이 존재한다. 

> 참고! **도메인 주도 설계(Domain-Driven Design, DDD)란**  
> ... DDD를 간략히 말하면 이렇습니다. 도메인, 즉 해당 분야의 관계자(클라이언트)와 개발 프로젝트 관계자가 클라이언트 업무에 대해 깊이 이야기를 나눕니다. 그리고 클라이언트가 언급하는 분야의 전문용어들을 꼼꼼히 체크하여, 클라이언트가 말하는 바와 개발 관계자가 이해한 의미가 같은지 합의를 도출합니다. 용어들을 하나하나 합의하여 전체적으로 개념들이 정립되면 이 개념들을 모아 ‘도메인 언어’라 이름 붙이고 설계에 적용합니다. 제대로 된 의사소통을 통해 요구사항을 모델화하고, 모델이라는 동일한 언어를 이용해 해당 분야에 쓸모 있는 설계를 하여 소프트웨어를 구현하는 것이 도메인 주도 설계의 요지입니다.  
> 출처 : [도서출판 인사이트-도메인 주도 설계란 무엇인가, 그것이 알고 싶다!](https://blog.insightbook.co.kr/2011/08/03/%EB%8F%84%EB%A9%94%EC%9D%B8-%EC%A3%BC%EB%8F%84-%EC%84%A4%EA%B3%84%EB%9E%80-%EB%AC%B4%EC%97%87%EC%9D%B8%EA%B0%80-%EA%B7%B8%EA%B2%83%EC%9D%B4-%EC%95%8C%EA%B3%A0-%EC%8B%B6%EB%8B%A4/)

## 역할
객체의 목적은 협력 안에서 객체가 맡게 되는 책임의 집합으로 정의된다. 여기서 책임의 집합을 **역할**이라고 부른다. 실제로 협력을 모델링할 때는 특정한 객체가 아니라 역할에게 책임을 할당한다고 생각하는 게 좋다.

### 유연하고 재사용 가능한 협력
역할이 중요한 이유는 역할을 통해 유연하고 재사용 가능한 협력을 만들 수 있기 때문이다. Movie가 가격을 계산하기 위해서는 할인 요금이 필요하다. 따라서 '할인 요금을 계산하라'는 메시지를 외부 객체에 전송해서 도움을 요청하게 된다. AmountDiscountPolicy, PercentDiscountPolicy 인스턴스가 이 메시지에 응답할 수 있어야 한다. 이 과정에서 두 종류의 객체가 참여하는 협력을 개별적으로 만들면 대부분의 코드가 중복되고 만다.  

문제를 해결하기 위해 '할인 요금을 계산하라'는 메시지에 응답할 수 있는 대표자(DiscountPolicy)를 설정하고 두 협력을 하나로 통합해야 한다. 이 대표자가 바로 역할이다. 다시 말하면 역할은 두 종류의 구체적인 객체를 포괄하는 **추상화**인 것이다. 역할을 이용하면서 불필요한 중복 코드를 줄이게 되었으며 새로운 할인 정책을 자유롭게 추가할 수 있게 되었다.  

### 역할 구현하기
역할을 구현하는 가장 일반적인 방법은 [추상 클래스와 인터페이스](https://github.com/yoo-jaein/object/blob/main/Chapter02.md#%EC%B6%94%EC%83%81-%ED%81%B4%EB%9E%98%EC%8A%A4-vs-%EC%9D%B8%ED%84%B0%ED%8E%98%EC%9D%B4%EC%8A%A4)를 사용하는 것이다.

## 불완전한 설계
우리가 살아가는 세계는 개념, 객체, 역할이 어지럽게 뒤섞여 있다. 도메인 모델 역시 동일한 불완전성을 가질 수밖에 없다. 따라서 한 번에 완벽한 설계를 만들어 내려고 노력하기 보단, 설계 초반에는 단순하게 객체로 시작하고 반복적으로 책임과 협력을 정제해가면서 필요한 순간에 객체로부터 역할을 분리해내는 것이 가장 좋은 방법이다.

## 결론
1. 객체는 여러 협력에 참여하면서 다양한 역할을 수행할 수 있다.
2. 배우가 하나의 연극에서 오직 하나의 배역을 연기하는 것처럼, 객체도 하나의 협력 안에서는 오직 하나의 역할만이 보여진다.
